<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>


<div class="d-flex justify-content-center mt-5">




	<div class="border rounded mt-3">

		<div class="p-2 d-flex justify-content-center">
			<span class="font-weight-bold">${hotel.hotelName}</span>
		</div>

		<div class="card-img">
			<img src="${hotel.imagePath}" width="300" height="300" alt="이미지">
		</div>

	</div>
</div>
<c:if test="${not empty userId}">
<div class="d-flex justify-content-center mt-5">
<div>
	<div class="form-group">
<label for="reply_star">별점</label>
	<span class="star-input">
		<span class="input">
    			<input type="radio" name="reply_star" class="point" id="p1" value="1">
    						<label for="p1">1</label>
    			<input type="radio" name="reply_star" id="p2" class="point"  value="2">
    						<label for="p2">2</label>
   			<input type="radio" name="reply_star" id="p3" class="point"  value="3">
   					 		<label for="p3">3</label>
  			<input type="radio" name="reply_star" id="p4" class="point"  value="4">
  							<label for="p4">4</label>
    			<input type="radio" name="reply_star" id="p5" class="point"  value="5">
    						<label for="p5">5</label>
    			<input type="radio" name="reply_star" id="p6" class="point"  value="6">
    						<label for="p6">6</label>
    			<input type="radio" name="reply_star" id="p7" class="point"  value="7">
    						<label for="p7">7</label>
    			<input type="radio" name="reply_star" id="p8" class="point"  value="8">
    						<label for="p8">8</label>
    			<input type="radio" name="reply_star" id="p9" class="point"  value="9">
    						<label for="p9">9</label>
    			<input type="radio" name="reply_star" id="p10" class="point"  value="10">
    						<label for="p10">10</label>
  		</span>
  				<output for="star-input"><b>0</b>점</output>						
	</span>
</div>
	<textarea rows="4" cols="40" id="reviewText${hotel.id}" class="form-control border-1 mr-2"
		placeholder="후기를 입력하세요"></textarea>
	</div>
	<div class="d-flex align-items-end ml-2">
		<button id="writeBtn" class="btn btn-info writeBtn" data-hotel-id="${hotel.id}">게시</button>
	</div>

</div>	
</c:if>
<div>#####  ${hotel.id}</div>
<c:forEach var="hotel" items="${reviewList}">
	<c:if test="${not empty hotel.review}">


		<div class="d-flex justify-content-center mt-5">
			<div class="contents-box col-9 rows-3">
				<div id="review-card" class="d-flex write-box border rounded m-3 review-detail">
					<div class="card w-100 h-100 border-0 ml-3">
						<div class="d-flex justify-content-center mt-2">
							<div>
								<div>${hotel.point}</div>
								<div>${hotel.review}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</c:if>
</c:forEach>
<script>

	// 댓글 쓰기
		$('.writeBtn').on('click', function(e) {
			e.preventDefault();
			
			let hotelId = $(this).data('hotel-id');
			alert(hotelId);
			let point = $('.point').val();
			alert(point + "#");
	
			
			let reviewText = $('#reviewText' + hotelId).val().trim(); // 글에 대한 댓글을 가져오기 위해 아이디 뒤에 동적으로 hotelId를 붙인다.
			if (reviewText.length < 1) {
				alert("후기 내용을 입력해주세요.");
				return;
			}
			if (reviewText.length > 255) {
				alert("255자까지만 입력가능합니다.");
				return;
			}
			
			alert(reviewText);
			$.ajax({
				type:'post',
				url:'/review/create',
				data: {"hotelId" : hotelId, "point" : point,"review" : reviewText},
				success: function(data) {
					if (data.result == 'success') {
						location.reload(); // 새로고침
					}
				},
				error: function(jqXHR, textStatus, errorThrown) {
					var errorMsg = jqXHR.responseJSON.status;
					alert(errorMsg + ":" + textStatus);
				}
			});
		});
		var starRating = function(){
			  var $star = $(".star-input"),
			      $result = $star.find("output>b");
			  $(document)
			    .on("focusin", ".star-input>.input", function(){
			    $(this).addClass("focus");
			  })
			    .on("focusout", ".star-input>.input", function(){
			    
			    	var $this = $(this);
			    
			    	setTimeout(function(){
			      
			    		if($this.find(":focus").length === 0){
			    			$this.removeClass("focus");
			    		}
			    }, 1000);
			  })
			    .on("change", ".star-input :radio", function(){
			    $result.text($(this).next().text());
			  })
			    .on("mouseover", ".star-input label", function(){
			    $result.text($(this).text());
			  })
			    .on("mouseleave", ".star-input>.input", function(){
			    
			    	var $checked = $star.find(":checked");
			    
			    	if($checked.length === 0){
			    		$result.text("0");
			    	} else {
			    		$result.text($checked.next().text());
			    	}
			  });
			};
			starRating();
	
		</script>
