<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<div class="d-flex justify-content-center ml-5">
	<div class="sign-up-box">
		<h1 class="mb-4">호텔 등록</h1>
		<form id="registrationForm" action="/admin/hotel_registration" method="post">
			<div class="d-flex">
					<div>
						<span>*호텔 이름</span>
						<input type="text" id="hotelName" name="hotelName"
							class="form-control" placeholder="호텔이름을 입력하세요."><br>
					
						<span>*호텔 주소</span>
						<input type="text" id="location" name="location"
							class="form-control" placeholder="호텔 주소를 입력하세요."><br>
						
						<span>*호텔 가격</span>
						<input type="text" id="price" name="price"
							class="form-control" placeholder="호텔가격 입력하세요."><br>
							
						<span>*호텔 번호</span>
						<input type="text" id="hotelNumber" name="hotelNumber"
							class="form-control" placeholder="호텔 전화번호를 입력하세요."><br>
						
						
					</div>
					<div class="ml-4">
						<span>*호텔 설명</span>
						<textarea id="hotel-detail" rows="9" cols="50" class="form-control mt-2" placeholder="호텔 설명을 입력해주세요"></textarea>
						
						<div class="d-flex justify-content-end mt-5">
							<input type="file" id="file" class="m-2" accept=".jpg,.jpeg,.png,.gif">
						</div>
						
					</div>
				</div>
				<div  class="d-flex justify-content-center">
					<button id="registrationBtn" class="btn btn-block ">호텔 등록</button>
				</div>
			</form>
	</div>
</div>

<script>
$(document).ready(function() {
	// 호텔등록버튼
	$('#registrationBtn').on('click', function(){
		let hotelName = $('#hotelName').val().trim();
		if (hotelName == '') {
			alert("호텔이름을 입력하세요");
			return;
		}
		
		let location = $('#location').val();
		if (location == ''){
			alert("호텔주소를 입력하세요");
			return;
		}
 
		let price = $('#price').val().trim();
		if (price ==''){
			alert("가격을 입력하세요");
			return;
		}
		let hotelNumber = $('#hotelNumber').val().trim();
		if (hotelNumber ==''){
			alert("호텔번호을 입력하세요");
			return;
		}
		let hotelDetail = $('#hotel-detail').val().trim();
		if (hotelDetail ==''){
			alert("호텔설명를 입력하세요");
			return;
		}
			
		let file = $('#file').val();
		console.log("file:" + file);
		
		if (file != ''){
			//console.log(file.split('.')); // 파일명을 . 기준으로 자른다.(배열에 저장)
			let ext = file.split('.').pop().toLowerCase()  //  split를 사용해서 .을 기준으로 나누고 pop()를 사용해서 마지막 배열을 가져온뒤toLowerCase()로 소문자로 만듬 // toLowerCase = 소문자로 바꿈, 대문자 => toUpperCase
			if ($.inArray(ext, ['jpg', 'jpeg', 'png', 'gif']) == -1 ){
				alert("이미지 파일만 업로드 할 수 있습니다.");
				$('#file').val('') // 잘못된 파일을 비운다.
				return;
			}
		}
		
		// 폼태그를 자바스크립트에서 만든다.
		let formData = new FormData();
		formData.append('hotelName', hotelName);
		formData.append('location', location);
		formData.append('price', price);
		formData.append('hotelNumber', hotelNumber);
		formData.append('hotel-detail', hotelDetail);
		formData.append('file', $('#file')[0].files[0]);
		
		// ajax
		$.ajax({
			type:'post' // get은 body가 없어서 url로 받아버림 그래서 무조건 post로 해야함!
			, url: '/post/create'
			, data: formData
			, enctype: 'mulitpart/form-data'// 파일 업로드 필수 설정
			, processData: false   // 파일 업로드 필수 설정
			, contentType: false   // 파일 업로드 필수 설정
			, success: function(data){
				if (data.result == 'success'){
					alert("호텔정보가 등록 됐습니다.");
					location.href ="/hotel/list_view";
				}
			}, error: function(e){
				alert("메모 저장에 실패했습니다." + e);
			}
		});
	});
});
</script>